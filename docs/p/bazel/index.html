<!DOCTYPE html>
<html lang="en-us" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='什么是 Bazel？ 简介 Bazel 是一个开源构建和测试工具，类似于 Make、Maven 和 Gradle。它使用人类可读的简要构建语言。Bazel 支持多种语言的项目，并针对多个平台构建输出。Bazel 支持跨多个代码库和大量用户的大型代码库。
特点  高级构建语言：使用人类可读的抽象语言在高度语义上描述项目的构建属性。与其他工具不同，Bazel 会根据库、二进制文件、脚本和数据集的概念进行操作，避免了编写对编译器和连接器等工具进行单独调用的复杂性。 快速而又可靠：借助高级的本地和分布式缓存来记录所有已经完成的工作，并跟踪对文件内容和构建命令所做的更改。这样，Bazel 就能知道何时需要重新构建某些内容，并且仅重建必要的内容。如需进一步加快构建速度，您可以将项目设置为以高度并行且增量的方式进行构建。 跨平台：可以在 Linux、macOS 和 Windows 上运行。Bazel 可以在同一个项目中为多个平台（包括桌面端、服务器和移动端）构建二进制文件和可部署软件包。 可伸缩：在处理具有 10 万多个源文件的 build 时，Bazel 也能够保持敏捷性。Bazel 还可以帮助你扩展你的组织、代码库和持续集成系统，它可与数以万计的代码库和用户群进行协作。 可拓展：支持如 C&#43;&#43;、Java、Android、iOS、Go和其他各种语言平台，并且可以使用 Bazel 熟悉的扩展语言轻松添加对新语言和平台的支持，分享和重用由不断增长的 Bazel 社区编写的语言规则。  使用流程 如果需要使用 Bazel 构建或测试项目，通常需要执行以下操作：
 设置 Bazel。下载并安装 Bazel。 设置项目的 WORKSPACE。这是 Bazel 用于查找构建输入、BUILD 文件的目录，以及存储构建输出的目录。 编写 BUILD 文件。告诉 Bazel 应该构建什么以及如何去构建。 通过命令行运行 Bazel。运行后 Bazel 会将结果输出至 WORKSPACE 中。  构建流程 当运行构建或测试时，Bazel 会执行以下操作：
 加载与目标相关的 BUILD 文件。 分析输入及其依赖项，应用指定的构建规则，并生成操作图。 对输入执行构建操作，直到生成最终构建输出。  基本概念 WORKSPACE（工作区） 工作区是一个目录，它包含了构建目标所需要的源码文件。每个工作区中都有一个名为 WORKSPACE 的文本文件，该文件可能为空，也可能包含构建输出所需的外部依赖的引用。包含名为 WORKSPACE 的文件的目录被视为工作区的根。'><title>Bazel</title>

<link rel='canonical' href='https://blog.orekilee.top/p/bazel/'>

<link rel="stylesheet" href="/scss/style.min.d9e0562edde3d2bdf9d3d81365095a29d062ddaaa5d671f22168e57dfdb18b4f.css"><meta property='og:title' content='Bazel'>
<meta property='og:description' content='什么是 Bazel？ 简介 Bazel 是一个开源构建和测试工具，类似于 Make、Maven 和 Gradle。它使用人类可读的简要构建语言。Bazel 支持多种语言的项目，并针对多个平台构建输出。Bazel 支持跨多个代码库和大量用户的大型代码库。
特点  高级构建语言：使用人类可读的抽象语言在高度语义上描述项目的构建属性。与其他工具不同，Bazel 会根据库、二进制文件、脚本和数据集的概念进行操作，避免了编写对编译器和连接器等工具进行单独调用的复杂性。 快速而又可靠：借助高级的本地和分布式缓存来记录所有已经完成的工作，并跟踪对文件内容和构建命令所做的更改。这样，Bazel 就能知道何时需要重新构建某些内容，并且仅重建必要的内容。如需进一步加快构建速度，您可以将项目设置为以高度并行且增量的方式进行构建。 跨平台：可以在 Linux、macOS 和 Windows 上运行。Bazel 可以在同一个项目中为多个平台（包括桌面端、服务器和移动端）构建二进制文件和可部署软件包。 可伸缩：在处理具有 10 万多个源文件的 build 时，Bazel 也能够保持敏捷性。Bazel 还可以帮助你扩展你的组织、代码库和持续集成系统，它可与数以万计的代码库和用户群进行协作。 可拓展：支持如 C&#43;&#43;、Java、Android、iOS、Go和其他各种语言平台，并且可以使用 Bazel 熟悉的扩展语言轻松添加对新语言和平台的支持，分享和重用由不断增长的 Bazel 社区编写的语言规则。  使用流程 如果需要使用 Bazel 构建或测试项目，通常需要执行以下操作：
 设置 Bazel。下载并安装 Bazel。 设置项目的 WORKSPACE。这是 Bazel 用于查找构建输入、BUILD 文件的目录，以及存储构建输出的目录。 编写 BUILD 文件。告诉 Bazel 应该构建什么以及如何去构建。 通过命令行运行 Bazel。运行后 Bazel 会将结果输出至 WORKSPACE 中。  构建流程 当运行构建或测试时，Bazel 会执行以下操作：
 加载与目标相关的 BUILD 文件。 分析输入及其依赖项，应用指定的构建规则，并生成操作图。 对输入执行构建操作，直到生成最终构建输出。  基本概念 WORKSPACE（工作区） 工作区是一个目录，它包含了构建目标所需要的源码文件。每个工作区中都有一个名为 WORKSPACE 的文本文件，该文件可能为空，也可能包含构建输出所需的外部依赖的引用。包含名为 WORKSPACE 的文件的目录被视为工作区的根。'>
<meta property='og:url' content='https://blog.orekilee.top/p/bazel/'>
<meta property='og:site_name' content='凌桓&#39;s BLOG'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='C&#43;&#43;' /><meta property='article:tag' content='Bazel' /><meta property='article:published_time' content='2022-07-01T18:54:13&#43;08:00'/><meta property='article:modified_time' content='2022-07-03T21:15:38&#43;08:00'/>
<meta name="twitter:title" content="Bazel">
<meta name="twitter:description" content="什么是 Bazel？ 简介 Bazel 是一个开源构建和测试工具，类似于 Make、Maven 和 Gradle。它使用人类可读的简要构建语言。Bazel 支持多种语言的项目，并针对多个平台构建输出。Bazel 支持跨多个代码库和大量用户的大型代码库。
特点  高级构建语言：使用人类可读的抽象语言在高度语义上描述项目的构建属性。与其他工具不同，Bazel 会根据库、二进制文件、脚本和数据集的概念进行操作，避免了编写对编译器和连接器等工具进行单独调用的复杂性。 快速而又可靠：借助高级的本地和分布式缓存来记录所有已经完成的工作，并跟踪对文件内容和构建命令所做的更改。这样，Bazel 就能知道何时需要重新构建某些内容，并且仅重建必要的内容。如需进一步加快构建速度，您可以将项目设置为以高度并行且增量的方式进行构建。 跨平台：可以在 Linux、macOS 和 Windows 上运行。Bazel 可以在同一个项目中为多个平台（包括桌面端、服务器和移动端）构建二进制文件和可部署软件包。 可伸缩：在处理具有 10 万多个源文件的 build 时，Bazel 也能够保持敏捷性。Bazel 还可以帮助你扩展你的组织、代码库和持续集成系统，它可与数以万计的代码库和用户群进行协作。 可拓展：支持如 C&#43;&#43;、Java、Android、iOS、Go和其他各种语言平台，并且可以使用 Bazel 熟悉的扩展语言轻松添加对新语言和平台的支持，分享和重用由不断增长的 Bazel 社区编写的语言规则。  使用流程 如果需要使用 Bazel 构建或测试项目，通常需要执行以下操作：
 设置 Bazel。下载并安装 Bazel。 设置项目的 WORKSPACE。这是 Bazel 用于查找构建输入、BUILD 文件的目录，以及存储构建输出的目录。 编写 BUILD 文件。告诉 Bazel 应该构建什么以及如何去构建。 通过命令行运行 Bazel。运行后 Bazel 会将结果输出至 WORKSPACE 中。  构建流程 当运行构建或测试时，Bazel 会执行以下操作：
 加载与目标相关的 BUILD 文件。 分析输入及其依赖项，应用指定的构建规则，并生成操作图。 对输入执行构建操作，直到生成最终构建输出。  基本概念 WORKSPACE（工作区） 工作区是一个目录，它包含了构建目标所需要的源码文件。每个工作区中都有一个名为 WORKSPACE 的文本文件，该文件可能为空，也可能包含构建输出所需的外部依赖的引用。包含名为 WORKSPACE 的文件的目录被视为工作区的根。">
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="切换菜单">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu79fea4b9296c85deb154197379070de6_22402_300x0_resize_box_3.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">🍥</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">凌桓&#39;s BLOG</a></h1>
            <h2 class="site-description">沙漠尽头必是绿洲</h2>
        </div>
    </header><ol class="social-menu">
            
                <li>
                    <a 
                        href='https://oreki.blog.csdn.net'
                        target="_blank"
                        title="CSDN"
                    >
                        
                        
                            <?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1653209063639" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2377" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><defs><style type="text/css">@font-face { font-family: feedback-iconfont; src: url("//at.alicdn.com/t/font_1031158_u69w8yhxdu.woff2?t=1630033759944") format("woff2"), url("//at.alicdn.com/t/font_1031158_u69w8yhxdu.woff?t=1630033759944") format("woff"), url("//at.alicdn.com/t/font_1031158_u69w8yhxdu.ttf?t=1630033759944") format("truetype"); }
</style></defs><path d="M512 1024C229.2224 1024 0 794.7776 0 512 0 229.2224 229.2224 0 512 0c282.7776 0 512 229.2224 512 512 0 282.7776-229.2224 512-512 512z m17.066667-413.525333c34.850133 4.352 68.778667 5.12 102.741333 2.0992 23.04-2.048 44.817067-8.362667 64.170667-21.9136 38.212267-26.794667 49.783467-85.1968 24.251733-123.050667-14.626133-21.7088-36.8128-30.344533-60.757333-35.498667-35.054933-7.543467-70.4512-5.751467-105.847467-3.413333-5.666133 0.3584-6.7584 3.072-7.236267 8.209067-3.072 32.682667-6.536533 65.314133-9.813333 97.962666-2.5088 24.814933-4.932267 49.629867-7.509333 75.605334z m53.4016-33.928534c1.962667-20.906667 3.6352-39.338667 5.4272-57.770666 1.553067-15.906133 3.413333-31.778133 4.727466-47.701334 0.3584-4.283733 1.553067-6.656 5.956267-6.382933 15.616 1.041067 31.709867 0.034133 46.728533 3.652267 36.488533 8.823467 48.725333 54.306133 23.3472 83.029333-15.8208 17.902933-36.7616 23.586133-59.255466 25.088-8.465067 0.546133-17.015467 0.085333-26.9312 0.085333zM512 434.295467c-2.184533-0.648533-3.5328-1.1776-4.932267-1.4336-37.717333-6.877867-75.690667-8.328533-113.646933-2.816-20.974933 3.037867-41.0112 9.489067-57.480533 23.330133-22.9888 19.319467-21.640533 46.848 4.4032 62.0032 13.056 7.594667 28.023467 12.509867 42.5984 17.288533 14.08 4.608 28.996267 6.826667 43.144533 11.264 12.5952 3.925333 14.011733 14.318933 3.584 22.306134-3.345067 2.56-7.441067 5.085867-11.537067 5.751466-11.195733 1.826133-22.698667 4.386133-33.826133 3.566934-24.098133-1.774933-48.042667-5.461333-72.5504-8.430934-1.365333 10.615467-2.935467 23.0912-4.5568 35.9424 4.181333 1.365333 7.68 2.730667 11.264 3.618134 33.9456 8.4992 68.386133 9.608533 102.912 5.12 20.087467-2.6112 39.4752-7.901867 56.695467-19.029334 28.603733-18.4832 36.693333-57.1904-4.676267-75.383466-14.506667-6.382933-30.190933-10.410667-45.482667-15.086934-11.4176-3.4816-23.313067-5.614933-34.525866-9.5232-9.7792-3.413333-11.144533-12.202667-3.037867-18.397866 4.6592-3.549867 10.717867-6.997333 16.384-7.3728a480.853333 480.853333 0 0 1 53.384533-0.853334c15.377067 0.699733 30.651733 3.549867 46.4896 5.5296L512 434.295467z m257.143467 2.048L750.933333 614.2976h54.152534c4.778667-45.636267 9.710933-90.7264 14.062933-135.8848 0.6144-6.365867 2.3552-8.840533 8.686933-9.0112 11.434667-0.273067 22.8864-1.979733 34.286934-1.570133 23.722667 0.853333 42.3936 9.728 38.4 43.264-2.901333 24.2688-5.597867 48.571733-8.2432 72.874666-1.092267 10.069333-1.826133 20.189867-2.730667 30.4128h55.330133c3.584-35.259733 7.9872-70.058667 10.496-104.994133 3.413333-47.4624-17.7664-73.3184-64.682666-80.213333-40.96-6.007467-81.339733-0.341333-121.5488 7.133866z m-483.498667 134.6048c-8.738133 1.297067-16.384 2.798933-24.098133 3.4816-25.6512 2.235733-51.319467 3.9424-76.305067-4.266667-13.909333-4.590933-24.6784-12.578133-29.7984-25.9584-7.901867-20.701867 0.887467-47.104 19.831467-60.3136 17.373867-12.117333 37.717333-15.9232 58.453333-15.9232 22.545067-0.017067 45.090133 2.423467 68.232533 3.84L307.2 432.298667c-15.069867-1.723733-29.4912-3.925333-43.997867-4.9152-41.0112-2.798933-80.64 2.6112-117.469866 20.462933-30.020267 14.557867-52.053333 36.010667-58.6752 68.130133-7.850667 38.144 11.537067 69.495467 51.7632 85.845334 19.1488 7.765333 39.287467 12.509867 60.0064 12.5952 24.746667 0.1024 49.493333-1.570133 74.205866-2.952534 3.106133-0.170667 8.311467-2.901333 8.669867-5.034666 1.979733-11.554133 2.730667-23.278933 3.9424-35.464534z" fill="#DD1700" p-id="2378"></path></svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='mailto:orekilee@163.com'
                        target="_blank"
                        title="Email"
                    >
                        
                        
                            <?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1653220689510" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1326" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><defs><style type="text/css">@font-face { font-family: feedback-iconfont; src: url("//at.alicdn.com/t/font_1031158_u69w8yhxdu.woff2?t=1630033759944") format("woff2"), url("//at.alicdn.com/t/font_1031158_u69w8yhxdu.woff?t=1630033759944") format("woff"), url("//at.alicdn.com/t/font_1031158_u69w8yhxdu.ttf?t=1630033759944") format("truetype"); }
</style></defs><path d="M874.666667 375.189333V746.666667a64 64 0 0 1-64 64H213.333333a64 64 0 0 1-64-64V375.189333l64 54.250667V746.666667h597.333334V429.44l64-54.250667zM810.666667 213.333333a64.789333 64.789333 0 0 1 22.826666 4.181334 63.616 63.616 0 0 1 26.794667 19.413333 64.32 64.32 0 0 1 9.344 15.466667c2.773333 6.570667 4.48 13.696 4.906667 21.184L874.666667 277.333333v21.333334L553.536 572.586667a64 64 0 0 1-79.893333 2.538666l-3.178667-2.56L149.333333 298.666667v-21.333334a63.786667 63.786667 0 0 1 35.136-57.130666A63.872 63.872 0 0 1 213.333333 213.333333h597.333334z m-9.6 64h-578.133334L512 523.882667 801.066667 277.333333z" p-id="1327"></path></svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://github.com/HONGYU-LEE'
                        target="_blank"
                        title="GitHub"
                    >
                        
                        
                            <?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg t="1653209160970" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1306" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><defs><style type="text/css">@font-face { font-family: feedback-iconfont; src: url("//at.alicdn.com/t/font_1031158_u69w8yhxdu.woff2?t=1630033759944") format("woff2"), url("//at.alicdn.com/t/font_1031158_u69w8yhxdu.woff?t=1630033759944") format("woff"), url("//at.alicdn.com/t/font_1031158_u69w8yhxdu.ttf?t=1630033759944") format("truetype"); }
</style></defs><path d="M512 42.666667A464.64 464.64 0 0 0 42.666667 502.186667 460.373333 460.373333 0 0 0 363.52 938.666667c23.466667 4.266667 32-9.813333 32-22.186667v-78.08c-130.56 27.733333-158.293333-61.44-158.293333-61.44a122.026667 122.026667 0 0 0-52.053334-67.413333c-42.666667-28.16 3.413333-27.733333 3.413334-27.733334a98.56 98.56 0 0 1 71.68 47.36 101.12 101.12 0 0 0 136.533333 37.973334 99.413333 99.413333 0 0 1 29.866667-61.44c-104.106667-11.52-213.333333-50.773333-213.333334-226.986667a177.066667 177.066667 0 0 1 47.36-124.16 161.28 161.28 0 0 1 4.693334-121.173333s39.68-12.373333 128 46.933333a455.68 455.68 0 0 1 234.666666 0c89.6-59.306667 128-46.933333 128-46.933333a161.28 161.28 0 0 1 4.693334 121.173333A177.066667 177.066667 0 0 1 810.666667 477.866667c0 176.64-110.08 215.466667-213.333334 226.986666a106.666667 106.666667 0 0 1 32 85.333334v125.866666c0 14.933333 8.533333 26.88 32 22.186667A460.8 460.8 0 0 0 981.333333 502.186667 464.64 464.64 0 0 0 512 42.666667" fill="#231F20" p-id="1307"></path></svg>
                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        

        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>主页</span>
            </a>
        </li>
        
        

        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>归档</span>
            </a>
        </li>
        
        

        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>搜索</span>
            </a>
        </li>
        
        

        <li >
            <a href='/%E5%85%B3%E4%BA%8E/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>关于</span>
            </a>
        </li>
        

        <div class="menu-bottom-section">
            
            
                <li id="dark-mode-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <span>暗色模式</span>
                </li>
            
        </div>
    </ol>
</aside>
<main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/%E5%B7%A5%E5%85%B7/" style="background-color: #2a9d8f; color: #fff;">
                工具
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/bazel/">Bazel</a>
        </h2>
    
        
    </div>

    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Jul 01, 2022</time>
            </div>
        

        
    </footer>
    

    
</div>
</header>

    <section class="article-content">
    
    
    <h1 id="什么是-bazel">什么是 Bazel？</h1>
<h2 id="简介">简介</h2>
<p>Bazel 是一个开源构建和测试工具，类似于 Make、Maven 和 Gradle。它使用人类可读的简要构建语言。Bazel 支持多种语言的项目，并针对多个平台构建输出。Bazel 支持跨多个代码库和大量用户的大型代码库。</p>
<h2 id="特点">特点</h2>
<ul>
<li><strong>高级构建语言</strong>：使用人类可读的抽象语言在高度语义上描述项目的构建属性。与其他工具不同，Bazel 会根据库、二进制文件、脚本和数据集的概念进行操作，避免了编写对编译器和连接器等工具进行单独调用的复杂性。</li>
<li><strong>快速而又可靠</strong>：借助高级的本地和分布式缓存来记录所有已经完成的工作，并跟踪对文件内容和构建命令所做的更改。这样，Bazel 就能知道何时需要重新构建某些内容，并且仅重建必要的内容。如需进一步加快构建速度，您可以将项目设置为以高度并行且增量的方式进行构建。</li>
<li><strong>跨平台</strong>：可以在 Linux、macOS 和 Windows 上运行。Bazel 可以在同一个项目中为多个平台（包括桌面端、服务器和移动端）构建二进制文件和可部署软件包。</li>
<li><strong>可伸缩</strong>：在处理具有 10 万多个源文件的 build 时，Bazel 也能够保持敏捷性。Bazel 还可以帮助你扩展你的组织、代码库和持续集成系统，它可与数以万计的代码库和用户群进行协作。</li>
<li><strong>可拓展</strong>：支持如 C++、Java、Android、iOS、Go和其他各种语言平台，并且可以使用 Bazel 熟悉的扩展语言轻松添加对新语言和平台的支持，分享和重用由不断增长的 Bazel 社区编写的语言规则。</li>
</ul>
<h2 id="使用流程">使用流程</h2>
<p>如果需要使用 Bazel 构建或测试项目，通常需要执行以下操作：</p>
<ol>
<li><strong>设置 Bazel</strong>。下载并安装 Bazel。</li>
<li><strong>设置项目的 WORKSPACE</strong>。这是 Bazel 用于查找构建输入、BUILD 文件的目录，以及存储构建输出的目录。</li>
<li><strong>编写 BUILD 文件</strong>。告诉 Bazel 应该构建什么以及如何去构建。</li>
<li><strong>通过命令行运行 Bazel</strong>。运行后 Bazel 会将结果输出至 WORKSPACE 中。</li>
</ol>
<h2 id="构建流程">构建流程</h2>
<p>当运行构建或测试时，Bazel 会执行以下操作：</p>
<ol>
<li>加载与目标相关的 BUILD  文件。</li>
<li>分析输入及其依赖项，应用指定的构建规则，并生成操作图。</li>
<li>对输入执行构建操作，直到生成最终构建输出。</li>
</ol>
<h2 id="基本概念">基本概念</h2>
<h3 id="workspace工作区">WORKSPACE（工作区）</h3>
<p>工作区是一个目录，它包含了构建目标所需要的源码文件。每个工作区中都有一个名为 WORKSPACE 的文本文件，该文件可能为空，也可能包含构建输出所需的外部依赖的引用。包含名为 WORKSPACE 的文件的目录被视为工作区的根。</p>
<p>代码以代码库形式组织。包含 WORKSPACE 文件的目录是主代码库的根目录，也称为 @。其他（外部）代码库是使用工作区规则在 WORKSPACE 文件中定义的。</p>
<h3 id="package包">PACKAGE（包）</h3>
<p>包是工作区中主要的代码组织单元，其中包含一系列相关的文以及描述这些文件之间关系的 BUILD 文件。</p>
<p>包是工作区的子目录，它的根目录必须包含文件 BUILD（或 BUILD.bazel）。除了那些具有 BUILD 文件的子包以外，其它子目录属于包的一部分。</p>
<h3 id="target目标">TARGET（目标）</h3>
<p>包是目标的容器，所以目标在包的 BUILD 文件中定义。 目标主要分为以下几种类型：</p>
<ul>
<li>
<p><strong>File（文件）</strong>：</p>
<ul>
<li><strong>源文件（Source File）</strong>：由相关人员编写的，并签入到代码库中。</li>
<li><strong>派生文件（Derived files）</strong>：又叫输出文件，是构建工具依据规则自动生成的文件。</li>
</ul>
</li>
<li>
<p><strong>Rule（规则）</strong>：每个规则实例均指定一组输入文件和输出文件之间的关系。 规则的输入可以是源文件，但也可以是其他规则的输出。</p>
<ul>
<li>
<p>在BUILD中声明规则的语法时：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">规则类型<span class="o">(</span>
</span></span><span class="line"><span class="cl">    <span class="nv">name</span> <span class="o">=</span> <span class="s2">&#34;...&#34;</span>,  <span class="c1">#必须</span>
</span></span><span class="line"><span class="cl">    <span class="nv">其它属性</span> <span class="o">=</span> ...	<span class="c1">#可选</span>
</span></span><span class="line"><span class="cl"><span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>规则的类型一般以编程语言为前缀，例如 cc，java，后缀通常有：</p>
<ul>
<li>
<p><code>*_binary</code>：用于构建目标语言的可执行文件</p>
</li>
<li>
<p><code>*_test</code>：用于自动化测试，其目标是可执行文件，如果测试通过应该返回零。</p>
</li>
<li>
<p><code>*_library</code>：用于构建目标语言的库</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>PACKAGE GROUP（包组）</strong>：即一组包，主要用于限制某些特定规则的可见性。由 <code>package_group</code> 函数定义。它们有三个属性：它们包含的包列表、名称以及它们包含的其他包组。引用它们的唯一方法来自规则的 <code>visibility</code> 属性或 <code>package</code> 函数的 <code>default_visibility</code> 属性，且它们不会生成或使用文件。</p>
</li>
</ul>
<p>规则生成的文件与规则本身始终属于同一个包，即无法将文件生成到其他包中。但是规则的输入可以来自其他包。</p>
<h3 id="label标签">LABEL（标签）</h3>
<p>目标的名称又被称为标签。每个标签都唯一标识一个目标。规范格式的典型标签如下所示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">@myrepo//my/app/main:app_binary
</span></span></code></pre></td></tr></table>
</div>
</div><p>以上面的标签为例，它由三部分组成</p>
<ul>
<li>
<p><strong>代码库名</strong>：标签的第一部分是代码库名称，例如上面的 <code>@myrepo//</code>。如果标签引用了其使用的同一个代码库，其代码库标识符可以缩写为 //，例如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">//my/app/main:app_binary
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><strong>包名</strong>：标签的第二部分是包名称 <code>my/app/main</code>，这是相对于代码库根目录的包路径。如果标签引用了其使用的同一个包，则可以省略包名称（还可以选择是否使用英文冒号进行分隔），例如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1">#两者等价</span>
</span></span><span class="line"><span class="cl">app_binary
</span></span><span class="line"><span class="cl">:app_binary
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><strong>目标名</strong>：标签后面的冒号部分 app_binary 是目标名称。当与软件包路径的最后一个组成部分匹配时，可以省略冒号和冒号，例如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1">#两者等价</span>
</span></span><span class="line"><span class="cl">//my/app/lib
</span></span><span class="line"><span class="cl">//my/app/lib:lib
</span></span></code></pre></td></tr></table>
</div>
</div><p>在 BUILD 文件中，引用当前包中定义的规则时，冒号不能省略。而引用当前包中文件时，冒号可以省略。 但是，从其它包引用时、从命令行引用时，都必须使用完整的标签。</p>
</li>
</ul>
<h3 id="build构建文件">BUILD（构建文件）</h3>
<p>每个包中都包含一个 BUILD 文件，而 BUILD 文件中的构建规则的每个实例又称为目标，并指向一组特定的源文件和依赖项。 目标还可以指向其他目标。</p>
<p>BUILD 文件包含几种不同类型的 Bazel 指令。最重要的类型是构建规则，告知 Bazel 如何构建所需的输出，例如可执行二进制文件或库。BUILD 文件中的语句会被从上而下的逐条解释，某些语句的顺序很重要， 例如变量必须先定义后使用，但是规则声明的顺序无所谓。</p>
<p>为了促进代码和数据之间的完全分离，BUILD 文件不能包含函数定义、for 语句或 if 语句，但可以在 .bzl 文件中声明函数、控制结构，并在BUILD文件中用 <code>load</code> 语句加载。例如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">load<span class="o">(</span><span class="s2">&#34;//foo/bar:file.bzl&#34;</span>, <span class="s2">&#34;some_library&#34;</span><span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>上面的语句加载 <code>foo/bar/file.bzl</code> 并添加其中定义的符号 <code>some_libraray</code> 到当前环境中，<code>load </code>语句可以用来加载规则、函数、常量（字符串、列表等）。（==参数必须是字符串字面量（无变量），并且 load 语句必须出现在顶层，它们不能位于函数正文中。==）</p>
<h3 id="dependency依赖项">DEPENDENCY（依赖项）</h3>
<p>如果在构建或执行时 A 需要目标 B，目标 A 会依赖于目标 B。依存关系会使目标产生有向无环图（DAG），这就是所谓的依赖图。</p>
<p><strong>直接依赖项</strong>是指依赖项图表中长度为 1 的路径可以访问的其他目标。 <strong>传递依赖项</strong>是指它通过图中任意长度的路径来依赖的那些目标。</p>
<p>大多数构建规则都具有三个用于指定不同类型通用依赖项的属性：srcs、deps 和 data。</p>
<ul>
<li><strong>srcs</strong>：直接输出源文件的规则所使用的文件。</li>
<li><strong>deps</strong>：指向独立编译的模块的规则，这些模块提供头文件、符号、库、数据等。</li>
<li><strong>data</strong>：构建目标可能需要一些数据文件才能正常运行。这些数据文件不是源代码：它们不会影响目标的构建方式。</li>
</ul>
<h1 id="实战">实战</h1>
<h2 id="环境搭建">环境搭建</h2>
<h3 id="安装-bazel">安装 Bazel</h3>
<p>这里以 CentOS 8 为例：</p>
<ol>
<li>
<p>首先从 Fedora COPR 下载相应的 .repo 文件并将其复制到 /etc/yum.repos.d/ 中：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">wget --no-check-certificate -P /etc/yum.repos.d/ https://copr.fedorainfracloud.org/coprs/vbatts/bazel/repo/epel-7/vbatts-bazel-epel-7.repo
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>使用 yum 安装 Bazel：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">yum -y install bazel4
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>查看 Bazel 版本号，看看是否安装成功：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">bazel --version
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ol>
<h3 id="安装示例项目">安装示例项目</h3>
<p>从 Bazel 的 GitHub 中下载官方提供的示例项目：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">git clone https://github.com/bazelbuild/examples
</span></span></code></pre></td></tr></table>
</div>
</div><p>示例项目位于 <code>examples/cpp-tutorial</code> 目录，结构如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">examples
</span></span><span class="line"><span class="cl">└── cpp-tutorial
</span></span><span class="line"><span class="cl">    ├──stage1
</span></span><span class="line"><span class="cl">    │  ├── main
</span></span><span class="line"><span class="cl">    │  │   ├── BUILD
</span></span><span class="line"><span class="cl">    │  │   └── hello-world.cc
</span></span><span class="line"><span class="cl">    │  └── WORKSPACE
</span></span><span class="line"><span class="cl">    ├──stage2
</span></span><span class="line"><span class="cl">    │  ├── main
</span></span><span class="line"><span class="cl">    │  │   ├── BUILD
</span></span><span class="line"><span class="cl">    │  │   ├── hello-world.cc
</span></span><span class="line"><span class="cl">    │  │   ├── hello-greet.cc
</span></span><span class="line"><span class="cl">    │  │   └── hello-greet.h
</span></span><span class="line"><span class="cl">    │  └── WORKSPACE
</span></span><span class="line"><span class="cl">    └──stage3
</span></span><span class="line"><span class="cl">       ├── main
</span></span><span class="line"><span class="cl">       │   ├── BUILD
</span></span><span class="line"><span class="cl">       │   ├── hello-world.cc
</span></span><span class="line"><span class="cl">       │   ├── hello-greet.cc
</span></span><span class="line"><span class="cl">       │   └── hello-greet.h
</span></span><span class="line"><span class="cl">       ├── lib
</span></span><span class="line"><span class="cl">       │   ├── BUILD
</span></span><span class="line"><span class="cl">       │   ├── hello-time.cc
</span></span><span class="line"><span class="cl">       │   └── hello-time.h
</span></span><span class="line"><span class="cl">       └── WORKSPACE
</span></span></code></pre></td></tr></table>
</div>
</div><p>示例主要分为三个阶段：</p>
<ul>
<li><strong>stage1</strong>：构建位于单个软件包中的单个目标。</li>
<li><strong>stage2</strong>：将项目拆分为多个目标，但将其保留在单个软件包中。</li>
<li><strong>stage3</strong>：将项目拆分为多个软件包，并使用多个目标进行构建。</li>
</ul>
<h2 id="c-项目构建示例">C++ 项目构建示例</h2>
<h3 id="基础知识">基础知识</h3>
<h4 id="构建项目">构建项目</h4>
<p>想要构建项目，只需要在命令行输入 <code>bazel build</code> 命令，并在其后面指定标签名，例如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">bazel build 标签名
</span></span></code></pre></td></tr></table>
</div>
</div><p>当构建执行成功时，就会在终端输出提示信息，其中包括每个目标构建输出的位置、构建时间、关键路径等，具体的输出信息可以参考下面的几个示例。</p>
<p>当构建完成后，可以使用 <code>bazel clean</code> 命令清除构建结果。</p>
<h4 id="查看依赖项图表">查看依赖项图表</h4>
<p>成功的构建会将其所有依赖项明确列在 BUILD 文件中。Bazel 会使用这些语句创建项目的依赖项图，以实现准确的增量构建。</p>
<p>如需直观呈现示例项目的依赖项，您可以通过在工作区根目录下运行以下命令，生成依赖项图的文本表示形式：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">bazel query --notool_deps --noimplicit_deps <span class="s2">&#34;依赖项属性(目标)&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --output graph
</span></span></code></pre></td></tr></table>
</div>
</div><p>上述命令指示 Bazel 查找目标的所有依赖项（不包括主机和隐式依赖项），并将输出格式化为图表。接着将文本粘贴到 <a class="link" href="http://www.webgraphviz.com/"  target="_blank" rel="noopener"
    >WebGraphviz</a> 中即可查看。</p>
<h3 id="示例一编译单个目标">示例一：编译单个目标</h3>
<p>首先我们需要查看示例一的 BUILD 文件，规则可参考该链接 <a class="link" href="https://bazel.build/reference/be/c-cpp#cc_library"  target="_blank" rel="noopener"
    >cc_library 规则</a>。文件内容如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">load<span class="o">(</span><span class="s2">&#34;@rules_cc//cc:defs.bzl&#34;</span>, <span class="s2">&#34;cc_binary&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">cc_binary<span class="o">(</span>
</span></span><span class="line"><span class="cl">    <span class="nv">name</span> <span class="o">=</span> <span class="s2">&#34;hello-world&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="nv">srcs</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&#34;hello-world.cc&#34;</span><span class="o">]</span>,
</span></span><span class="line"><span class="cl"><span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>可以看到，依赖关系非常简单，只需要编译一个 TARGET，并且这个 TARGET 也只依赖于 hello-world.cc。直接运行构建命令：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">bazel build //main:hello-world
</span></span></code></pre></td></tr></table>
</div>
</div><p>此时 Bazel 生成以下输出信息：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">Starting <span class="nb">local</span> Bazel server and connecting to it...
</span></span><span class="line"><span class="cl">INFO: Analyzed target //main:hello-world <span class="o">(</span><span class="m">15</span> packages loaded, <span class="m">57</span> targets configured<span class="o">)</span>.
</span></span><span class="line"><span class="cl">INFO: Found <span class="m">1</span> target...
</span></span><span class="line"><span class="cl">Target //main:hello-world up-to-date:
</span></span><span class="line"><span class="cl">  bazel-bin/main/hello-world
</span></span><span class="line"><span class="cl">INFO: Elapsed time: 14.070s, Critical Path: 1.19s
</span></span><span class="line"><span class="cl">INFO: <span class="m">6</span> processes: <span class="m">4</span> internal, <span class="m">2</span> processwrapper-sandbox.
</span></span><span class="line"><span class="cl">INFO: Build completed successfully, <span class="m">6</span> total actions
</span></span></code></pre></td></tr></table>
</div>
</div><p>执行生成的二进制文件，看看是否能够正常运行：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">bazel-bin/main/hello-world
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#输出</span>
</span></span><span class="line"><span class="cl">Hello world
</span></span><span class="line"><span class="cl">Sun Jun  <span class="m">5</span> 18:14:07 <span class="m">2022</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>接着生成示例项目的依赖项图表：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">bazel query --notool_deps --noimplicit_deps <span class="s2">&#34;deps(//main:hello-world)&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --output graph
</span></span></code></pre></td></tr></table>
</div>
</div><p>此时输出依赖项文本如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">digraph mygraph <span class="o">{</span>
</span></span><span class="line"><span class="cl">  node <span class="o">[</span><span class="nv">shape</span><span class="o">=</span>box<span class="o">]</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;//main:hello-world&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;//main:hello-world&#34;</span> -&gt; <span class="s2">&#34;//main:hello-world.cc&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;//main:hello-world.cc&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>将其复制到 <a class="link" href="http://www.webgraphviz.com/"  target="_blank" rel="noopener"
    >WebGraphviz</a> 中，得到的依赖项图表如下：</p>
<p><img src="http://img.orekilee.top//imgbed/bazel/bazel1.png"
	
	
	
	loading="lazy"
	
	
></p>
<!-- raw HTML omitted -->
<p>如上图，示例一仅具有一个目标，该目标会构建没有其他依赖项的单个源文件。</p>
<h3 id="示例二编译多个目标">示例二：编译多个目标</h3>
<p>接着我们查看示例二的 BUILD 文件：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">load<span class="o">(</span><span class="s2">&#34;@rules_cc//cc:defs.bzl&#34;</span>, <span class="s2">&#34;cc_binary&#34;</span>, <span class="s2">&#34;cc_library&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">cc_library<span class="o">(</span>
</span></span><span class="line"><span class="cl">    <span class="nv">name</span> <span class="o">=</span> <span class="s2">&#34;hello-greet&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="nv">srcs</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&#34;hello-greet.cc&#34;</span><span class="o">]</span>,
</span></span><span class="line"><span class="cl">    <span class="nv">hdrs</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&#34;hello-greet.h&#34;</span><span class="o">]</span>,
</span></span><span class="line"><span class="cl"><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">cc_binary<span class="o">(</span>
</span></span><span class="line"><span class="cl">    <span class="nv">name</span> <span class="o">=</span> <span class="s2">&#34;hello-world&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="nv">srcs</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&#34;hello-world.cc&#34;</span><span class="o">]</span>,
</span></span><span class="line"><span class="cl">    <span class="nv">deps</span> <span class="o">=</span> <span class="o">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;:hello-greet&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="o">]</span>,
</span></span><span class="line"><span class="cl"><span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>在这个 BUILD 文件中存在两个 TARGET，分别是库文件 hello-greet 与 可执行文件 hello-world。由于 hello-world 目标中的 deps 属性说明该目标的构建依赖于 hello-greet，因此在构建时会先构建 hello-greet 库，再根据这个库构建 hello-world。</p>
<p>执行下面的命令开始构建：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">bazel build //main:hello-world
</span></span></code></pre></td></tr></table>
</div>
</div><p>输出结果如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">Starting <span class="nb">local</span> Bazel server and connecting to it...
</span></span><span class="line"><span class="cl">INFO: Analyzed target //main:hello-world <span class="o">(</span><span class="m">15</span> packages loaded, <span class="m">60</span> targets configured<span class="o">)</span>.
</span></span><span class="line"><span class="cl">INFO: Found <span class="m">1</span> target...
</span></span><span class="line"><span class="cl">Target //main:hello-world up-to-date:
</span></span><span class="line"><span class="cl">  bazel-bin/main/hello-world
</span></span><span class="line"><span class="cl">INFO: Elapsed time: 11.865s, Critical Path: 0.25s
</span></span><span class="line"><span class="cl">INFO: <span class="m">7</span> processes: <span class="m">4</span> internal, <span class="m">3</span> processwrapper-sandbox.
</span></span><span class="line"><span class="cl">INFO: Build completed successfully, <span class="m">7</span> total actions
</span></span></code></pre></td></tr></table>
</div>
</div><p>执行生成的二进制文件，看看是否能够正常运行：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">bazel-bin/main/hello-world
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#输出</span>
</span></span><span class="line"><span class="cl">Hello world
</span></span><span class="line"><span class="cl">Sun Jun  <span class="m">5</span> 20:01:37 <span class="m">2022</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>接着生成示例项目的依赖项图表：</p>
<p><img src="http://img.orekilee.top//imgbed/bazel/bazel2.png"
	
	
	
	loading="lazy"
	
	
></p>
<!-- raw HTML omitted -->
<p>如上图，示例二构建包含两个目标的项目。hello-world 目标会构建一个源文件，并依赖于另一个目标 hello-greet，后者会构建两个额外的源文件。</p>
<h3 id="示例三编译多个包">示例三：编译多个包</h3>
<p>由于示例三中需要对多个包进行编译，所以我们首先使用 <code>tree</code> 命令来看看它们的目录结构：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">.
</span></span><span class="line"><span class="cl">├── lib
</span></span><span class="line"><span class="cl">│   ├── BUILD
</span></span><span class="line"><span class="cl">│   ├── hello-time.cc
</span></span><span class="line"><span class="cl">│   └── hello-time.h
</span></span><span class="line"><span class="cl">├── main
</span></span><span class="line"><span class="cl">│   ├── BUILD
</span></span><span class="line"><span class="cl">│   ├── hello-greet.cc
</span></span><span class="line"><span class="cl">│   ├── hello-greet.h
</span></span><span class="line"><span class="cl">│   └── hello-world.cc
</span></span><span class="line"><span class="cl">├── README.md
</span></span><span class="line"><span class="cl">└── WORKSPACE
</span></span></code></pre></td></tr></table>
</div>
</div><p>可以看到，在工作区中包含了两个子目录 lib 和 main，并且这两个子目录中都有 BUILD 文件，因此它们都是包。</p>
<p>接着查看这两个包中的 BUILD 文件：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1">#lib/BUILD</span>
</span></span><span class="line"><span class="cl">load<span class="o">(</span><span class="s2">&#34;@rules_cc//cc:defs.bzl&#34;</span>, <span class="s2">&#34;cc_library&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">cc_library<span class="o">(</span>
</span></span><span class="line"><span class="cl">    <span class="nv">name</span> <span class="o">=</span> <span class="s2">&#34;hello-time&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="nv">srcs</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&#34;hello-time.cc&#34;</span><span class="o">]</span>,
</span></span><span class="line"><span class="cl">    <span class="nv">hdrs</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&#34;hello-time.h&#34;</span><span class="o">]</span>,
</span></span><span class="line"><span class="cl">    <span class="nv">visibility</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&#34;//main:__pkg__&#34;</span><span class="o">]</span>,
</span></span><span class="line"><span class="cl"><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#main/BUILD</span>
</span></span><span class="line"><span class="cl">load<span class="o">(</span><span class="s2">&#34;@rules_cc//cc:defs.bzl&#34;</span>, <span class="s2">&#34;cc_binary&#34;</span>, <span class="s2">&#34;cc_library&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">cc_library<span class="o">(</span>
</span></span><span class="line"><span class="cl">    <span class="nv">name</span> <span class="o">=</span> <span class="s2">&#34;hello-greet&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="nv">srcs</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&#34;hello-greet.cc&#34;</span><span class="o">]</span>,
</span></span><span class="line"><span class="cl">    <span class="nv">hdrs</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&#34;hello-greet.h&#34;</span><span class="o">]</span>,
</span></span><span class="line"><span class="cl"><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">cc_binary<span class="o">(</span>
</span></span><span class="line"><span class="cl">    <span class="nv">name</span> <span class="o">=</span> <span class="s2">&#34;hello-world&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="nv">srcs</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&#34;hello-world.cc&#34;</span><span class="o">]</span>,
</span></span><span class="line"><span class="cl">    <span class="nv">deps</span> <span class="o">=</span> <span class="o">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;:hello-greet&#34;</span>,
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;//lib:hello-time&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="o">]</span>,
</span></span><span class="line"><span class="cl"><span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>我们发现，这两个包中存在跨包依赖。main 包中的 hello-world 不仅依赖于本包的 hello-greet，还依赖于 lib 包中的 hello-time。因此我们需要确保 lib 包中的 hello-time 对 main 包中的 hello-world 可见（默认情况下仅对同一 BUILD 文件中的其他目标可见，即可见性为 <code>//visibility:private</code>），这时就需要在 hello-time 目标中加上 visibility 属性，并将可见性设置为 <code>//main:__pkg__</code>，即对 main 包可见。</p>
<p>执行下面的命令开始构建：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">bazel build //main:hello-world
</span></span></code></pre></td></tr></table>
</div>
</div><p>输出结果如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">Starting <span class="nb">local</span> Bazel server and connecting to it...
</span></span><span class="line"><span class="cl">INFO: Analyzed target //main:hello-world <span class="o">(</span><span class="m">16</span> packages loaded, <span class="m">63</span> targets configured<span class="o">)</span>.
</span></span><span class="line"><span class="cl">INFO: Found <span class="m">1</span> target...
</span></span><span class="line"><span class="cl">Target //main:hello-world up-to-date:
</span></span><span class="line"><span class="cl">  bazel-bin/main/hello-world
</span></span><span class="line"><span class="cl">INFO: Elapsed time: 8.273s, Critical Path: 0.26s
</span></span><span class="line"><span class="cl">INFO: <span class="m">8</span> processes: <span class="m">4</span> internal, <span class="m">4</span> processwrapper-sandbox.
</span></span><span class="line"><span class="cl">INFO: Build completed successfully, <span class="m">8</span> total actions
</span></span></code></pre></td></tr></table>
</div>
</div><p>执行生成的二进制文件，看看是否能够正常运行：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">bazel-bin/main/hello-world
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#输出</span>
</span></span><span class="line"><span class="cl">Hello world
</span></span><span class="line"><span class="cl">Sun Jun  <span class="m">5</span> 20:26:44 <span class="m">2022</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>接着生成示例项目的依赖项图表：</p>
<p><img src="http://img.orekilee.top//imgbed/bazel/bazel3.png"
	
	
	
	loading="lazy"
	
	
></p>
<!-- raw HTML omitted -->
<h2 id="c-常见构建方法">C++ 常见构建方法</h2>
<h3 id="在目标中包含多个文件">在目标中包含多个文件</h3>
<blockquote>
<p>Glob 是一个辅助函数，可用于查找符合特定路径模式的所有文件，并返回一个包含可变排序的新路径列表。Glob 仅在自己的包中搜索文件，并且仅查找源文件（而不是生成的文件或其他目标）。</p>
</blockquote>
<p>如果想在单个目标中包含多个文件，可以使用 <code>glob</code> 函数来进行文件匹配，例如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">cc_library<span class="o">(</span>
</span></span><span class="line"><span class="cl">    <span class="nv">name</span> <span class="o">=</span> <span class="s2">&#34;build-all-the-files&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="nv">srcs</span> <span class="o">=</span> glob<span class="o">([</span><span class="s2">&#34;*.cc&#34;</span><span class="o">])</span>,
</span></span><span class="line"><span class="cl">    <span class="nv">hdrs</span> <span class="o">=</span> glob<span class="o">([</span><span class="s2">&#34;*.h&#34;</span><span class="o">])</span>,
</span></span><span class="line"><span class="cl"><span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>使用此目标时，Bazel 将在其找到的包含此目标的 BUILD 文件所在的目录（不包括子目录）中构建找到的所有 .cc 和 .h 文件。</p>
<h3 id="使用传递性包含">使用传递性包含</h3>
<p>如果文件包含一个头文件，那么任何以该文件为源的规则（即在 srcs、hdrs 或 textual_hdrs 属性中有该文件）都应该依赖于所包含的头文件的库规则。反过来说，只有直接依赖项才需要指定为依赖项。</p>
<p>假设 sandwich.h 包含 bread.h，bread.h 包含 flour.h。sandwich.h 不包括 flour.h，因此 BUILD 文件将如下所示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">cc_library<span class="o">(</span>
</span></span><span class="line"><span class="cl">    <span class="nv">name</span> <span class="o">=</span> <span class="s2">&#34;sandwich&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="nv">srcs</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&#34;sandwich.cc&#34;</span><span class="o">]</span>,
</span></span><span class="line"><span class="cl">    <span class="nv">hdrs</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&#34;sandwich.h&#34;</span><span class="o">]</span>,
</span></span><span class="line"><span class="cl">    <span class="nv">deps</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&#34;:bread&#34;</span><span class="o">]</span>,
</span></span><span class="line"><span class="cl"><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">cc_library<span class="o">(</span>
</span></span><span class="line"><span class="cl">    <span class="nv">name</span> <span class="o">=</span> <span class="s2">&#34;bread&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="nv">srcs</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&#34;bread.cc&#34;</span><span class="o">]</span>,
</span></span><span class="line"><span class="cl">    <span class="nv">hdrs</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&#34;bread.h&#34;</span><span class="o">]</span>,
</span></span><span class="line"><span class="cl">    <span class="nv">deps</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&#34;:flour&#34;</span><span class="o">]</span>,
</span></span><span class="line"><span class="cl"><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">cc_library<span class="o">(</span>
</span></span><span class="line"><span class="cl">    <span class="nv">name</span> <span class="o">=</span> <span class="s2">&#34;flour&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="nv">srcs</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&#34;flour.cc&#34;</span><span class="o">]</span>,
</span></span><span class="line"><span class="cl">    <span class="nv">hdrs</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&#34;flour.h&#34;</span><span class="o">]</span>,
</span></span><span class="line"><span class="cl"><span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>此时 sandwich 库依赖于 bread 库，又 bread 依赖于 flour 库。</p>
<h3 id="添加包含路径">添加包含路径</h3>
<p>如果不想在工作区的根目录中设置包含（include）路径。而现有的库可能已经有了一个 include 目录，但是它却与工作区中的路径不一致，例如下面目录结构：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">└── my-project
</span></span><span class="line"><span class="cl">    ├── legacy
</span></span><span class="line"><span class="cl">    │   └── some_lib
</span></span><span class="line"><span class="cl">    │       ├── BUILD
</span></span><span class="line"><span class="cl">    │       ├── include
</span></span><span class="line"><span class="cl">    │       │   └── some_lib.h
</span></span><span class="line"><span class="cl">    │       └── some_lib.cc
</span></span><span class="line"><span class="cl">    └── WORKSPACE
</span></span></code></pre></td></tr></table>
</div>
</div><p>Bazel 应该包含 some_lib.h 作为 legacy/some_lib/include/some_lib.h，但假设 some_lib.cc 包含 some_lib.h。要使该包含路径有效，legacy/some_lib/BUILD 需要在 copts 属性中指定 some_lib/include 目录是包含目录：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">cc_library<span class="o">(</span>
</span></span><span class="line"><span class="cl">    <span class="nv">name</span> <span class="o">=</span> <span class="s2">&#34;some_lib&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="nv">srcs</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&#34;some_lib.cc&#34;</span><span class="o">]</span>,
</span></span><span class="line"><span class="cl">    <span class="nv">hdrs</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&#34;include/some_lib.h&#34;</span><span class="o">]</span>,
</span></span><span class="line"><span class="cl">    <span class="nv">copts</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&#34;-Ilegacy/some_lib/include&#34;</span><span class="o">]</span>,
</span></span><span class="line"><span class="cl"><span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>这对于外部依赖项尤其有用，因为其头文件必须包含 / 前缀。</p>
<h3 id="包括外部库">包括外部库</h3>
<blockquote>
<p>gtest（Google Test）是一个跨平台的（Liunx、Mac OS X、Windows等）C++单元测试框架，由 Google发布。gtest 是为在不同平台上为编写 C++ 测试而生成的。它提供了丰富的断言、致命和非致命判断、参数化、死亡测试等等。</p>
</blockquote>
<p>当我们需要引入一个外部库时，可以使用 WORKSPACE 文件中的某个代码库函数下载，并代码库中提供它，这里以 gtest 为例：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">load<span class="o">(</span><span class="s2">&#34;@bazel_tools//tools/build_defs/repo:http.bzl&#34;</span>, <span class="s2">&#34;http_archive&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">http_archive<span class="o">(</span>
</span></span><span class="line"><span class="cl">    <span class="nv">name</span> <span class="o">=</span> <span class="s2">&#34;gtest&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="nv">url</span> <span class="o">=</span> <span class="s2">&#34;https://github.com/google/googletest/archive/release-1.10.0.zip&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="nv">sha256</span> <span class="o">=</span> <span class="s2">&#34;94c634d499558a76fa649edb13721dce6e98fb1e7018dfaeba3cd7a083945e91&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="nv">build_file</span> <span class="o">=</span> <span class="s2">&#34;@//:gtest.BUILD&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>接着创建 gtest 的 BUILD 文件，由于 gtest 具有几项特殊要求，使得其 cc_library 规则更加复杂：</p>
<ul>
<li><code>googletest-release-1.10.0/src/gtest-all.cc</code> <code>#include</code> 对 <code>googletest-release-1.10.0/src/</code> 中的所有其他文件执行排除操作：将其从编译中排除，以防止出现重复符号的链接错误。</li>
<li>它使用相对于 <code>googletest-release-1.10.0/include/</code> 目录 (gtest/gtest.h) 的头文件，因此必须将该目录添加到包含路径。</li>
<li>它需要关联 pthread，因此需要添加为 linkopt。</li>
</ul>
<p>规则将如下所示：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">cc_library<span class="o">(</span>
</span></span><span class="line"><span class="cl">    <span class="nv">name</span> <span class="o">=</span> <span class="s2">&#34;main&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="nv">srcs</span> <span class="o">=</span> glob<span class="o">(</span>
</span></span><span class="line"><span class="cl">        <span class="o">[</span><span class="s2">&#34;googletest-release-1.10.0/src/*.cc&#34;</span><span class="o">]</span>,
</span></span><span class="line"><span class="cl">        <span class="nv">exclude</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&#34;googletest-release-1.10.0/src/gtest-all.cc&#34;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">    <span class="o">)</span>,
</span></span><span class="line"><span class="cl">    <span class="nv">hdrs</span> <span class="o">=</span> glob<span class="o">([</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;googletest-release-1.10.0/include/**/*.h&#34;</span>,
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;googletest-release-1.10.0/src/*.h&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">])</span>,
</span></span><span class="line"><span class="cl">    <span class="nv">copts</span> <span class="o">=</span> <span class="o">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;-Iexternal/gtest/googletest-release-1.10.0/include&#34;</span>,
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;-Iexternal/gtest/googletest-release-1.10.0&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">]</span>,
</span></span><span class="line"><span class="cl">    <span class="nv">linkopts</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&#34;-pthread&#34;</span><span class="o">]</span>,
</span></span><span class="line"><span class="cl">    <span class="nv">visibility</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&#34;//visibility:public&#34;</span><span class="o">]</span>,
</span></span><span class="line"><span class="cl"><span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>由于所有内容都以 <code>googletest-release-1.10.0</code> 为前缀，是归档结构的副产物。可以通过添加 strip_prefix 属性让 http_archive 去除此前缀：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">load<span class="o">(</span><span class="s2">&#34;@bazel_tools//tools/build_defs/repo:http.bzl&#34;</span>, <span class="s2">&#34;http_archive&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">http_archive<span class="o">(</span>
</span></span><span class="line"><span class="cl">    <span class="nv">name</span> <span class="o">=</span> <span class="s2">&#34;gtest&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="nv">url</span> <span class="o">=</span> <span class="s2">&#34;https://github.com/google/googletest/archive/release-1.10.0.zip&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="nv">sha256</span> <span class="o">=</span> <span class="s2">&#34;94c634d499558a76fa649edb13721dce6e98fb1e7018dfaeba3cd7a083945e91&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="nv">build_file</span> <span class="o">=</span> <span class="s2">&#34;@//:gtest.BUILD&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="nv">strip_prefix</span> <span class="o">=</span> <span class="s2">&#34;googletest-release-1.10.0&#34;</span>,
</span></span><span class="line"><span class="cl"><span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>此时 gtest.BUILD 可以简化为：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">cc_library<span class="o">(</span>
</span></span><span class="line"><span class="cl">    <span class="nv">name</span> <span class="o">=</span> <span class="s2">&#34;main&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="nv">srcs</span> <span class="o">=</span> glob<span class="o">(</span>
</span></span><span class="line"><span class="cl">        <span class="o">[</span><span class="s2">&#34;src/*.cc&#34;</span><span class="o">]</span>,
</span></span><span class="line"><span class="cl">        <span class="nv">exclude</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&#34;src/gtest-all.cc&#34;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">    <span class="o">)</span>,
</span></span><span class="line"><span class="cl">    <span class="nv">hdrs</span> <span class="o">=</span> glob<span class="o">([</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;include/**/*.h&#34;</span>,
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;src/*.h&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="o">])</span>,
</span></span><span class="line"><span class="cl">    <span class="nv">copts</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&#34;-Iexternal/gtest/include&#34;</span><span class="o">]</span>,
</span></span><span class="line"><span class="cl">    <span class="nv">linkopts</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&#34;-pthread&#34;</span><span class="o">]</span>,
</span></span><span class="line"><span class="cl">    <span class="nv">visibility</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&#34;//visibility:public&#34;</span><span class="o">]</span>,
</span></span><span class="line"><span class="cl"><span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>编写一个使用 gtest 的测试代码，看看是否能够成功构建：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;gtest/gtest.h&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;main/hello-greet.h&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="n">TEST</span><span class="p">(</span><span class="n">HelloTest</span><span class="p">,</span> <span class="n">GetGreet</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">get_greet</span><span class="p">(</span><span class="s">&#34;Bazel&#34;</span><span class="p">),</span> <span class="s">&#34;Hello Bazel&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>创建测试文件的 BUILD：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">cc_test(
</span></span><span class="line"><span class="cl">    name = &#34;hello-test&#34;,
</span></span><span class="line"><span class="cl">    srcs = [&#34;hello-test.cc&#34;],
</span></span><span class="line"><span class="cl">    copts = [&#34;-Iexternal/gtest/include&#34;],
</span></span><span class="line"><span class="cl">    deps = [
</span></span><span class="line"><span class="cl">        &#34;@gtest//:main&#34;,
</span></span><span class="line"><span class="cl">        &#34;//main:hello-greet&#34;,
</span></span><span class="line"><span class="cl">    ],
</span></span><span class="line"><span class="cl">)
</span></span></code></pre></td></tr></table>
</div>
</div><p>使用 <code>bazel test</code> 进行测试：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">bazel <span class="nb">test</span> test:hello-test
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#输出</span>
</span></span><span class="line"><span class="cl">INFO: Found <span class="m">1</span> <span class="nb">test</span> target...
</span></span><span class="line"><span class="cl">Target //test:hello-test up-to-date:
</span></span><span class="line"><span class="cl">  bazel-bin/test/hello-test
</span></span><span class="line"><span class="cl">INFO: Elapsed time: 4.497s, Critical Path: 2.53s
</span></span><span class="line"><span class="cl">//test:hello-test PASSED in 0.3s
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Executed <span class="m">1</span> out of <span class="m">1</span> tests: <span class="m">1</span> <span class="nb">test</span> passes.
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="添加对预编译库的依赖关系">添加对预编译库的依赖关系</h3>
<p>如果想使用只包含已编译版本的库（例如头文件和 .so 文件），就需要将其封装在 cc_library 规则中，例如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">cc_library<span class="o">(</span>
</span></span><span class="line"><span class="cl">    <span class="nv">name</span> <span class="o">=</span> <span class="s2">&#34;mylib&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="nv">srcs</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&#34;mylib.so&#34;</span><span class="o">]</span>,
</span></span><span class="line"><span class="cl">    <span class="nv">hdrs</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&#34;mylib.h&#34;</span><span class="o">]</span>,
</span></span><span class="line"><span class="cl"><span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div>
</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/c&#43;&#43;/">C&#43;&#43;</a>
        
            <a href="/tags/bazel/">Bazel</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    <section class="article-lastmod">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



        <span>
            最后更新于 Jul 03, 2022 21:15 CST
        </span>
    </section></footer>


    
        <link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css"integrity="sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn"crossorigin="anonymous"
            ><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js"integrity="sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8"crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js"integrity="sha384-vZTG03m&#43;2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl"crossorigin="anonymous"
                defer
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
        renderMathInElement(document.querySelector(`.article-content`), {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ]
        });})
</script>
    
</article>

    

    

<aside class="related-contents--wrapper">
    <h2 class="section-title">相关文章</h2>
    <div class="related-contents">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/p/gdb/">
        
        

        <div class="article-details">
            <h2 class="article-title">GDB</h2>
        </div>
    </a>
</article>
            
                
<article class="">
    <a href="/p/google-test/">
        
        

        <div class="article-details">
            <h2 class="article-title">Google Test</h2>
        </div>
    </a>
</article>
            
                
<article class="">
    <a href="/p/cmake/">
        
        

        <div class="article-details">
            <h2 class="article-title">CMake</h2>
        </div>
    </a>
</article>
            
        </div>
    </div>
</aside>

     
    
        
    <script src='//cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js'></script>
<div id="waline" class="waline-container"></div>
<style>
    .waline-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
    }
    .waline-container .vcount {
        color: var(--card-text-color-main);
    }
</style><script>
    
    new Waline({"avatar":"wavatar","dark":"html[data-scheme=\"dark\"]","el":"#waline","emoji":["https://cdn.jsdelivr.net/gh/walinejs/emojis/weibo"],"lang":"zh-CN","locale":{"admin":"Admin"},"placeholder":"休得弄脏我的评论，注册后再与我对话","requiredMeta":["name","email","url"],"serverURL":"https://comment.orekilee.top/"});
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2022 凌桓&#39;s BLOG
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        主题 <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.11.0">Stack</a></b> 由 <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> 设计
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css"integrity="sha256-c0uckgykQ9v5k&#43;IqViZOZKc47Jn7KQil4/MP3ySA3F8="crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css"integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE="crossorigin="anonymous"
            >

            </main>
    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">目录</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#简介">简介</a></li>
    <li><a href="#特点">特点</a></li>
    <li><a href="#使用流程">使用流程</a></li>
    <li><a href="#构建流程">构建流程</a></li>
    <li><a href="#基本概念">基本概念</a>
      <ol>
        <li><a href="#workspace工作区">WORKSPACE（工作区）</a></li>
        <li><a href="#package包">PACKAGE（包）</a></li>
        <li><a href="#target目标">TARGET（目标）</a></li>
        <li><a href="#label标签">LABEL（标签）</a></li>
        <li><a href="#build构建文件">BUILD（构建文件）</a></li>
        <li><a href="#dependency依赖项">DEPENDENCY（依赖项）</a></li>
      </ol>
    </li>
  </ol>

  <ol>
    <li><a href="#环境搭建">环境搭建</a>
      <ol>
        <li><a href="#安装-bazel">安装 Bazel</a></li>
        <li><a href="#安装示例项目">安装示例项目</a></li>
      </ol>
    </li>
    <li><a href="#c-项目构建示例">C++ 项目构建示例</a>
      <ol>
        <li><a href="#基础知识">基础知识</a>
          <ol>
            <li><a href="#构建项目">构建项目</a></li>
            <li><a href="#查看依赖项图表">查看依赖项图表</a></li>
          </ol>
        </li>
        <li><a href="#示例一编译单个目标">示例一：编译单个目标</a></li>
        <li><a href="#示例二编译多个目标">示例二：编译多个目标</a></li>
        <li><a href="#示例三编译多个包">示例三：编译多个包</a></li>
      </ol>
    </li>
    <li><a href="#c-常见构建方法">C++ 常见构建方法</a>
      <ol>
        <li><a href="#在目标中包含多个文件">在目标中包含多个文件</a></li>
        <li><a href="#使用传递性包含">使用传递性包含</a></li>
        <li><a href="#添加包含路径">添加包含路径</a></li>
        <li><a href="#包括外部库">包括外部库</a></li>
        <li><a href="#添加对预编译库的依赖关系">添加对预编译库的依赖关系</a></li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js"integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
